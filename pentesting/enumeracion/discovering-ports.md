# Discovering ports

Existen varias maneras de descubrir puertos abiertos de un objetivo.

## nmap
La mas habitual es utilizar [nmap](/pentesting/herramientas/nmap.md). Este es un ejemplo de su uso.

```bash 
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 192.168.11.161 -oA allPorts
```

![](/.gitbook/assets/nmap01.png)

## Script manual

A veces, una vez estamos dentro de una máquina, necesitamos escanear los puertos abiertos por si hay algún servicio que no esté visible desde fuera, debido a firewalls. También es necesario realizar escaneo de puertos manualmente cuando se hace **pivoting** a otras redes y no se cuenta con herramientas.

Se muestra a continuación un script, que llamaremos **portDiscovery.sh**, que busca puertos abiertos dentro de una máquina.

```bash
#!/bin/bash

function ctlr_c(){
	echo -e "\n\n[!] Saliendo...\n"
	tput cnorm
	exit 1
}

# Ctlr+C
trap ctlr_c INT

tput civis
for port in $(seq 1 65535); do
	timeout 1 bash -c "echo '' > /dev/tcp/192.168.11.160/$port" 2>/dev/null && echo "[+] Port $port - OPEN" &
done
wait
tput cnorm
```

![](/.gitbook/assets/ports01.png)

Para saber mas en detalle como y por qué de este script, (que hace tput, ctlr_c, ...), visionar este video a partir del minuto 1:10:00, <https://www.youtube.com/watch?v=L1jSoCcvRY4>
